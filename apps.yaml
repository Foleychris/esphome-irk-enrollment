---
global_modules:
  - influx

    #offset_calibration:
    #  class: OffsetCalibration
    #  module: temperature
    #  global_dependencies:
    #    - influx
    #  climate_entity: climate.thermostat_2
    #  temperature_entity:
    #    - sensor.main_floor_sensor_bme280_temperature
    #    - sensor.bedroom_sensor_bme280_temperature
    #    - sensor.david_office_sensor_bme280_temperature
    #    - sensor.aysylu_office_sensor_bme280_temperature
    #
    ## TODO incorporate into the implementation
    ## TODO compute diffusion for non-primary rooms? (maybe fuck it because the new house doesn't care)
    #convergence_speed_calibration:
    #  class: ConvergenceSpeedCalibration
    #  module: temperature
    #  global_dependencies:
    #    - influx
    #  climate_entity: climate.thermostat_2
    #
    #bedroom_goal:
    #  class: ClimateGoal
    #  module: temperature
    #  dependencies:
    #    - offset_calibration
    #  people_trackers:
    #    - device_tracker.david_iphone
    #    - device_tracker.aysylu_iphone
    #  presence_ent: True
    #  room: bedroom
    #  temp_ent: sensor.bedroom_sensor_bme280_temperature
    #  preferences:
    #    safe:
    #      high: 80
    #      low: 60
    #    tolerable:
    #      high: 76
    #      low: 67
    #    agreeable:
    #      high: 74
    #      low: 69
    #  tasks:
    #    dna_sleeping:
    #      high: 72
    #      low: 68
    #      selfish: True # means that we are the only goal that matters
    #
    #main_floor_goal:
    #  class: ClimateGoal
    #  module: temperature
    #  dependencies:
    #    - offset_calibration
    #  people_trackers:
    #    - device_tracker.david_iphone
    #    - device_tracker.aysylu_iphone
    #  presence_ent: True
    #  room: main
    #  temp_ent: sensor.main_floor_sensor_bme280_temperature
    #  preferences:
    #    safe:
    #      high: 80
    #      low: 60
    #    tolerable:
    #      high: 76
    #      low: 67
    #    agreeable:
    #      high: 74
    #      low: 69
    #
    #aysylu_office_goal:
    #  class: ClimateGoal
    #  module: temperature
    #  dependencies:
    #    - offset_calibration
    #  people_trackers:
    #    - device_tracker.aysylu_iphone
    #  presence_ent: True
    #  room: aysylu_office
    #  temp_ent: sensor.aysylu_office_sensor_bme280_temperature
    #  preferences:
    #    safe:
    #      high: 86
    #      low: 60
    #    tolerable:
    #      high: 76
    #      low: 67
    #    agreeable:
    #      high: 74
    #      low: 70
    #
    #david_office_goal:
    #  class: ClimateGoal
    #  module: temperature
    #  dependencies:
    #    - offset_calibration
    #  people_trackers:
    #    - device_tracker.david_iphone
    #  presence_ent: True
    #  room: david_office
    #  temp_ent: sensor.david_office_sensor_bme280_temperature
    #  preferences:
    #    safe:
    #      high: 86
    #      low: 60
    #    tolerable:
    #      high: 76
    #      low: 67
    #    agreeable:
    #      high: 74
    #      low: 69
    #
    #quarterdeck_impl:
    #  class: ClimateImplementor
    #  module: temperature
    #  dependencies:
    #    - david_office_goal
    #    - main_floor_goal
    #    - aysylu_office_goal
    #    - bedroom_goal
    #  climate_entity: climate.thermostat_2
    #  weather_entity: weather.home
    #  max_temp_for_heat: 70
    #  min_temp_for_ac: 60
    #  rooms:
    #    - main
    #    - bedroom
    #    - aysylu_office
    #    - david_office

tracker_test:
  class: IrkTracker
  module: irk_tracker
  training_input_text: input_text.irk_tag
  data_loc: tracker_logs/
  rows_per_flush: 100
  identities:
    - device_name: 'david phone'
      irk: 0C9582B2C7D3BE4B8BE2E2C33FFEFA8F
      person: david
    - device_name: 'david watch'
      irk: 57d899b39a9bca384e89ab741b56d3bd
      person: david
    - device_name: 'aysylu phone'
      irk: 678DDF7B3BDB195106A67E5BC12E556F
      person: aysylu
    - device_name: 'aysylu watch'
      irk: 0033354fb61c4f44f2389c68298802e4
      person: aysylu
  away_trackers:
    - person: david
      tracker: device_tracker.david_iphone
    - person: aysylu
      tracker: device_tracker.aysylu_iphone
  rssi_adjustments:
    bedroom_blinds: 15
    living_room_blinds: 15
  tracking_window_minutes: 3
  tracking_min_superplurality: 1.2
  ping_halflife_seconds: 60
  room_aliases:
    basement_beacon: downstairs
    ep1-david-office: david-office
    living_room_blinds: main-floor
    garage_assistant:
      secondary_clarifiers:
        - downstairs
        - main-floor
    ep1-main-floor: main-floor
    bedroom_blinds: bedroom
    underbed:
      secondary_clarifiers:
        - main-floor
        - bedroom

  #example_light:
  #  class: foo
  #  module: foo
  #  triggers:
  #    - presence:
  #      - sensor1
  #      - sensor2
  #      delay_on: 0s
  #      delay_off: 30s
  #      turns_on: True
  #      turns_off: True
  #      transition: 4
  #    - presence:
  #      - adjacent_room_sensor1
  #      - adjacent_room_sensor2
  #      delay_on: 5s
  #      delay_off: 0s
  #      max_brightness: 30%
  #      turns_on: True
  #      turns_off: True
  #      transition: 5
  #    - task: doing_a_thing
  #      turns_on: True
  #      turns_off: False
  #  fake_when_away: True
  #  people_trackers:
  #    - device_tracker.david_iphone
  #    - device_tracker.aysylu_iphone
  #  daily_off_time: 04:00:00
  #  adaptive_lighting: switch.adaptive_lighting_default



living_room_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - task: input_boolean.watching_tv
      max_brightness: 30%
      transition: 8
    - presence:
      - binary_sensor.main_floor_occupancy
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.living_room

curio_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - presence:
      #- binary_sensor.main_floor_occupancy
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
      condition: input_boolean.it_is_evening
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.curio_lights

dining_room_accent_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - task: input_boolean.watching_tv
      state: turned_off
      transition: 8
    - presence:
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
      condition: input_boolean.it_is_evening
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.triangle_lamp


dining_room_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - task: input_boolean.watching_tv
      state: turned_off
      transition: 8
    - presence:
      - binary_sensor.main_floor_occupancy
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.dining_table_fan_fixture

david_office_lights:
  class: LightController
  module: lights
  triggers:
   - task:
     - input_boolean.dna_sleeping
     - input_boolean.david_in_bed
     state: turned_off
   - presence:
     - binary_sensor.david_office_occupancy
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.david_office

aysylu_office_lights:
  class: LightController
  module: lights
  triggers:
   - task:
     - input_boolean.dna_sleeping
     - input_boolean.aysylu_in_bed
     state: turned_off
   - presence:
     - device_tracker.aysylu_iphone == home
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.aysylu_office_ceiling

aysylu_office_lamp:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.aysylu_in_bed
      state: turned_off
    - presence:
      - device_tracker.aysylu_iphone == home
      condition: input_boolean.it_is_evening
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.aysylu_office_lamp

stairs_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - task: input_boolean.watching_tv
      state: turned_off
      transition: 8
    - presence:
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.stairs

coffee_table_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - presence:
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
      condition: input_boolean.it_is_evening
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.coffee_table

kitchen_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      - input_text.test_helper_text == sleep
      state: turned_off
    - presence:
      - binary_sensor.main_floor_occupancy
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.kitchen

downstairs_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - presence:
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.downstairs

downstairs_geoleaf_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - binary_sensor.desktop_kl479rj_power_status != unavailable
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.wled

bedroom_near_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      - input_boolean.aysylu_in_bed
      state: turned_off
    - task:
      - binary_sensor.someone_in_bed
      max_brightness: 50%
    - presence:
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.bedroom_near

bedroom_far_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      state: turned_off
    - task:
      - input_boolean.david_in_bed
      - input_boolean.aysylu_in_bed
      max_brightness: 1%
    - presence:
      - device_tracker.david_iphone == home
      - device_tracker.aysylu_iphone == home
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.bedroom_near

basic_thermostat:
  class: BasicThermostatController
  module: temperature
  climate_entity: climate.thermostat_2
  max_diff_for_heat_pump: 4
  heat:
    outside_splitpoint: 62
    warm_day: 70
    cool_day: 72
    sleep: 68
    away: 64
  cool:
    outside_splitpoint: 70
    warm_day: 72
    cool_day: 72
    sleep: 68
    away: 77
  presence:
    - device_tracker.david_iphone == home
    - device_tracker.aysylu_iphone == home
      #- input_boolean.test_helper
