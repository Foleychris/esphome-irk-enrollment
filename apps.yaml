---
global_modules:
  - global_user_id

global_user_id:
  class: GlobalUserInfo
  module: lights
  user_id: 5851a5ea934047d5943e66b3012ac053

tracker:
  class: IrkTracker
  module: irk_tracker
  #log: irk_tracker_log
  training_input_text: input_text.irk_tag
  data_loc: tracker_logs/
  rows_per_flush: 100
  identities: !secret irk_tracker_identities
  # Example -- TODO document how to retrieve IRK for devices
  #    - device_name: 'david phone'
  #      irk: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXF
  #      person: david
  #    - device_name: 'david watch'
  #      irk: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
  #      person: david
  #    - device_name: 'partner phone'
  #      irk: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
  #      person: aysylu
  #    - device_name: 'partner watch'
  #      irk: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
  #      person: aysylu
  away_tracker_arrival_delay_secs: 120
  away_trackers:
    - person: david
      tracker: device_tracker.david_iphone
      home_focused_tracker: device_tracker.david_fused
    - person: aysylu
      tracker: device_tracker.aysylu_iphone
      home_focused_tracker: device_tracker.aysylu_fused
  pullout_sensors:
    - entity: binary_sensor.garage_occupied
      from: 'on'
      to: 'off'
      within_top: 2
      nearest_beacons:
        - garage_assistant
  rssi_adjustments:
    bedroom_blinds: 15
    living_room_blinds: 12
  tracking_window_minutes: 3
  tracking_min_superplurality: 1.3
  ping_halflife_seconds: 60
  room_aliases:
    basement_beacon: downstairs
    ep1-david-office:
      secondary_clarifiers:
        - basement_beacon: main-floor
        - ep1-bedroom: david-office
        - underbed: david-office
      default: david-office
    ep1-aysylu-office: aysylu-office
    living_room_blinds: main-floor
    garage_assistant:
      secondary_clarifiers:
        - downstairs
        - main-floor
        - ep1-aysylu-office: main-floor
    ep1-main-floor: main-floor
    bedroom_blinds: bedroom
    ep1-bedroom: bedroom
    underbed:
      secondary_clarifiers:
        - main-floor
        - bedroom
        - garage_assistant: main-floor
      default: bedroom

  #example_light:
  #  class: foo
  #  module: foo
  #  triggers:
  #    - presence:
  #      - sensor1
  #      - sensor2
  #      delay_on: 0s
  #      delay_off: 30s
  #      turns_on: True
  #      turns_off: True
  #      transition: 4
  #    - presence:
  #      - adjacent_room_sensor1
  #      - adjacent_room_sensor2
  #      delay_on: 5s
  #      delay_off: 0s
  #      max_brightness: 30%
  #      turns_on: True
  #      turns_off: True
  #      transition: 5
  #    - task: doing_a_thing
  #      turns_on: True
  #      turns_off: False
  #  fake_when_away: True
  #  people_trackers:
  #    - device_tracker.david_iphone
  #    - device_tracker.aysylu_iphone
  #  daily_off_time: 04:00:00
  #  adaptive_lighting: switch.adaptive_lighting_default



living_room_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      state: turned_off
    - task: input_boolean.watching_tv
      max_brightness: 30%
      transition: 8
    - presence:
      - device_tracker.david_fused in [home, just_arrived]
      - device_tracker.aysylu_fused in [home, just_arrived]
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.living_room

curio_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      state: turned_off
    - presence:
      #- binary_sensor.main_floor_occupancy
      - device_tracker.david_fused in [home, just_arrived]
      - device_tracker.aysylu_fused in [home, just_arrived]
      #- input_text.test_helper_text == sleep
      condition: input_boolean.it_is_evening
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.curio_lights
  #debug: True

dining_room_accent_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      state: turned_off
    - task: input_boolean.watching_tv
      state: turned_off
      transition: 8
    - presence:
      - device_tracker.david_fused in [home, just_arrived]
      - device_tracker.aysylu_fused in [home, just_arrived]
      condition: input_boolean.it_is_evening
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.triangle_lamp


dining_room_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - task: input_boolean.watching_tv
      state: turned_off
      transition: 8
    - presence:
      - binary_sensor.main_floor_occupancy
      - device_tracker.david_fused in [home, just_arrived]
      - device_tracker.aysylu_fused in [home, just_arrived]
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.dining_table_fan_fixture

david_office_lights:
  class: LightController
  module: lights
  triggers:
    - presence:
      - binary_sensor.david_office_occupancy
      #- input_text.test_helper_text == home
      delay_off: 30
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.david_office

aysylu_office_lights:
  class: LightController
  module: lights
  triggers:
    - presence:
      - binary_sensor.aysylu_office_occupancy
      delay_off: 30
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.aysylu_office_ceiling

aysylu_office_lamp:
  class: LightController
  module: lights
  triggers:
    - presence:
      - binary_sensor.aysylu_office_occupancy
      condition: input_boolean.it_is_evening
      delay_off: 30
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.aysylu_office_lamp

stairs_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - task: input_boolean.watching_tv
      state: turned_off
      transition: 8
    - presence:
      - device_tracker.david_fused in [home, just_arrived]
      - device_tracker.aysylu_fused in [home, just_arrived]
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.stairs

coffee_table_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - presence:
      - device_tracker.david_fused in [home, just_arrived]
      - device_tracker.aysylu_fused in [home, just_arrived]
      condition: input_boolean.it_is_evening
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.coffee_table
  #debug: True

kitchen_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      #- input_text.test_helper_text == sleep
      state: turned_off
    - presence:
      - binary_sensor.main_floor_occupancy
      - device_tracker.david_fused in [home, just_arrived]
      - device_tracker.aysylu_fused in [home, just_arrived]
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.kitchen

downstairs_lights:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      state: turned_off
    - presence:
      - device_tracker.david_fused in [home, just_arrived]
      - device_tracker.aysylu_fused in [home, just_arrived]
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.downstairs

downstairs_geoleaf_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - binary_sensor.desktop_kl479rj_power_status != unavailable
      - binary_sensor.supercomputer_power_status != unavailable
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.wled

bedroom_near_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      - input_boolean.david_in_bed
      - input_boolean.aysylu_in_bed
      state: turned_off
    - task:
      - binary_sensor.someone_in_bed
      max_brightness: 30%
    - presence:
      - binary_sensor.bedroom_occupancy
      delay_off: 30
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.bedroom_near
  #debug: True

bedroom_far_light:
  class: LightController
  module: lights
  triggers:
    - task:
      - input_boolean.dna_sleeping
      state: turned_off
    - task:
      - input_boolean.david_in_bed
      - input_boolean.aysylu_in_bed
      max_brightness: 1%
    - presence:
      - binary_sensor.bedroom_occupancy
      delay_off: 30
  adaptive_lighting: switch.adaptive_lighting_default
  light: light.bedroom_far
  #debug: True

basic_thermostat:
  class: BasicThermostatController
  module: temperature
  report_entity: sensor.basic_thermostat_controller
  climate_entity: climate.thermostat_2
  hourly_weather: weather.home_hourly # optional/default
  max_diff_for_heat_pump: 4
  heat:
    outside_splitpoint: 62
    warm_day: 70
    cool_day: 72
    sleep: 68
    away: 64
  cool:
    outside_splitpoint: 70
    warm_day: 72
    cool_day: 72
    sleep: 68
    away: 77
  events:
    sleep:
      name: ios.action_fired
      actionName: wind_down
    wake:
      name: ios.action_fired
      actionName: morning_alarm
  presence:
    - device_tracker.david_fused in [home, just_arrived]
    - device_tracker.aysylu_fused in [home, just_arrived]
      #- input_boolean.test_helper

in_bed_tracker:
  class: BedStateManager
  module: state_mgmt
  wake_event: wake_up
  away_distance: 60
  iphones:
    david:
      ssid: sensor.davids_iphone_ssid
      charging: sensor.davids_iphone_battery_state
      distance: sensor.david_iphone_calc_distance
      bed_tracker: input_boolean.david_in_bed
    aysylu:
      ssid: sensor.aysylu_iphone_ssid
      charging: sensor.aysylu_iphone_battery_state
      distance: sensor.aysylu_iphone_calc_distance
      bed_tracker: input_boolean.aysylu_in_bed
  bed_tracker: input_boolean.dna_sleeping
  bed_presence: binary_sensor.someone_in_bed
  bedtime_start: '21:00:00'
  bedtime_end: '5:00:00'
  home_ssids:
    - 74ax4k
    - internetofshxt

evening_tracking:
  class: EveningTracker
  module: state_mgmt
  tracker: input_boolean.it_is_evening
  sunset_offset: 0
  sunrise_offset: 0

lirr_fetcher:
  class: LirrFetcher
  module: lirr_fetcher
  max_lookback_mins: 45

parking_booker:
  class: GoPortParkingController
  module: goportparking
  username: !secret goportparking_username
  password: !secret goportparking_password
  plates:
    - KTT9990
